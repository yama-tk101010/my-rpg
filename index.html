<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yama RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Sawarabi+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="prologue-scene">
        <h1>🏰 YAMA RPG</h1>
        <div class="story-content">
            <p>王様の命を受けた3人の冒険者。</p>
            <p>深淵なる迷宮と、凶暴なドラゴン。</p>
            <p>装備を整え、レベルを上げ、伝説となれ。</p>
        </div>
        <br>
        <button class="btn" onclick="startGame()">冒険を始める</button>
    </div>

    <div id="town-scene" style="display: none;">
        <div class="screen-box">
            <h1>🏰 YAMA RPG</h1>
            <h2>安全な町 - SAFE HAVEN</h2>
            <div style="text-align:right; color:#ffd700; font-weight:bold; margin-bottom:5px;">
                💰 <span id="town-gold">0</span> G
            </div>
            <div id="town-status"></div>
            <p>どこへ向かいますか？</p>
        </div>
        
        <div class="menu-list" id="town-menu-list">
            <button class="btn menu-btn" onclick="townAction('inn')">① 宿屋 (回復)</button>
            <button class="btn menu-btn" onclick="townAction('shop')">② 道具屋 (売買)</button>
            <button class="btn menu-btn" onclick="townAction('temple')">③ 神殿 (転職/LvUP)</button>
            <button class="btn menu-btn" onclick="openCamp('town')">⛺ メニュー (装備/道具)</button>
            <button class="btn menu-btn btn-go" onclick="townAction('dungeon')">④ 地下迷宮へ</button>
            <button id="btn-forest" class="btn menu-btn" disabled style="border-color:#5f5; color:#5f5;" onclick="enterForest()">⑤ 試練の森へ</button>
        </div>
        <div id="town-log" class="log-box">
            <p>あなたは町の広場に立っている。</p>
        </div>
    </div>

    <div id="shop-scene" style="display: none;">
        <div class="screen-box">
            <h2>💰 道具屋</h2>
            <div style="text-align:right; color:#ffd700;">所持金: <span id="shop-gold">0</span> G</div>
            <div id="shop-list" class="scroll-list"></div>
            <button class="btn" onclick="exitShop()" style="margin-top:10px;">店を出る</button>
        </div>
    </div>

    <div id="temple-scene" style="display: none;">
        <div class="screen-box" style="border-color: #33ffff;">
            <h2>🔮 転職の神殿</h2>
            <p style="font-size:0.8em;">対象者を選択してください</p>
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; margin-bottom:10px;" id="temple-members"></div>
            <hr>
            <div id="temple-menu">
                <button class="btn" onclick="showJobChange()">転職する</button>
                <button class="btn" onclick="checkLevelUp()">レベルアップ</button>
            </div>
            <div id="job-select-area" style="display:none;">
                <p>職業を選択してください</p>
                <div class="grid-2col" id="job-buttons"></div>
                <div id="job-desc" class="desc-box"></div>
                <button class="btn btn-magic" onclick="executeClassChange()">✨ 決定</button>
            </div>
            <div id="levelup-area" style="display:none;">
                <p>能力ボーナス割り振り</p>
                <div id="levelup-stats"></div>
                <p>残りポイント: <span id="bonus-points" style="color:#ff3;">0</span></p>
                <button class="btn btn-magic" onclick="executeLevelUp()">💪 成長する</button>
            </div>
            <button class="btn" onclick="exitTemple()" style="margin-top:20px;">町へ戻る</button>
        </div>
    </div>

    <div id="status-scene" style="display: none;">
        <div class="screen-box" style="border-color: #aaaaff; max-height: 90vh; overflow-y: auto;">
            <h2>📊 ステータス</h2>
            <div id="status-content"></div>
            <button class="btn" onclick="closeStatusMenu()" style="margin-top:10px;">閉じる</button>
        </div>
    </div>

    <div id="sub-menu-overlay" style="display: none;">
        <div class="screen-box" style="border-color: #ffffff;">
            <h2 id="sub-menu-title">MENU</h2>
            <div id="sub-menu-content" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; max-height:55vh; overflow-y:auto;"></div>
            <button class="btn" onclick="closeSubMenu()" style="margin-top:10px;">↩️ 戻る</button>
        </div>
    </div>

    <div id="camp-overlay" style="display: none;">
        <div class="screen-box">
            <h2>⛺ メニュー</h2>
            <div style="display:grid; grid-template-columns: 1fr; gap:10px;">
                <button class="btn" onclick="openCampSpellMenu()">⚡ 呪文を使う</button> <button class="btn" onclick="openEquipMenu()">⚔️ 装備変更</button>
                <button class="btn" onclick="openItemMenu()">💊 アイテムを使う</button>
                <button class="btn" onclick="openStatusMenu()">📊 強さを見る</button>
                <button class="btn" id="btn-camp-check" onclick="checkAreaCamp()" style="display:none;">🔍 足元を調べる</button>
                <button class="btn" onclick="closeCamp()">↩️ 戻る</button>
            </div>
        </div>
    </div>

    <div id="dungeon-scene" style="display: none;">
        <div id="game-container">
            <div id="main-area">
                <canvas id="dungeon-canvas" width="300" height="200"></canvas>
                <img id="enemy-img" src="" alt="Monster">
                <div id="vfx-layer"></div>
                <div class="cave-overlay"></div>
            </div>

            <div id="map-wrapper">
                <div id="floor-display">迷宮 B1F</div>
                <div id="map-area"></div>
            </div>

            <div id="status">
                <div class="party-status" id="dungeon-party-status"></div>
                
                <div class="status-right-col">
                    <div class="location-info">
                        X:<span id="c-x">1</span> Y:<span id="c-y">8</span> <span id="c-dir">北</span>
                    </div>
                    <div id="enemy-stat" style="visibility: hidden; color:#ff5555; margin-top:2px;">
                        👾 <span id="enemy-name"></span>
                    </div>
                </div>
            </div>

            <div id="log" class="log-box">
                <p>> 探索を開始した。</p>
            </div>

            <div id="battle-msg" style="display:none;">あなたのターン</div>

            <div id="move-controls" class="controls move-pad">
                <div></div>
                <button class="btn" onclick="movePlayer('forward')">⬆️ 進む</button>
                <div></div>
                <button class="btn" onclick="turnPlayer('left')">🔄 左向</button>
                <button class="btn" onclick="openCamp('dungeon')">⛺ メニュー</button>
                <button class="btn" onclick="turnPlayer('right')">🔃 右向</button>
                <div></div>
                <button class="btn" onclick="movePlayer('backward')">⬇️ 下がる</button>
                <div></div>
                <button id="btn-return" class="btn" onclick="returnToTown()" style="grid-column: 1 / -1; margin-top:5px; border-color:#ffd700; color:#ffd700; display:none;">🏠 町へ戻る</button>
            </div>

            <div id="battle-controls" class="controls battle-pad">
                <button class="btn btn-atk" onclick="fight('attack')">⚔️ 攻撃</button>
                <button class="btn btn-magic" onclick="openSpellMenu()">⚡ 呪文</button>
                <button class="btn" onclick="openBattleItemMenu()">💊 アイテム</button>
                <button class="btn btn-def" onclick="fight('defend')">🛡️ 防御</button>
                <button class="btn" onclick="fight('run')" style="grid-column: 1 / -1;">💨 逃げる</button>
            </div>

            <div id="spell-controls" class="controls spell-pad">
                <button class="btn btn-magic" id="btn-spell-flame" onclick="castSpell('flame')">🔥 フレイム</button>
                <button class="btn btn-magic" id="btn-spell-heal" onclick="castSpell('heal')">✨ ヒール</button>
                <button class="btn btn-atk" id="btn-skill-double" onclick="castSpell('double')">⚔️ 二段切り</button>
                <button class="btn" onclick="closeSpellMenu()" style="grid-column: span 2;">↩️ 戻る</button>
            </div>

            <div id="target-controls" class="controls spell-pad">
                <div style="grid-column: 1 / -1; color:#fff; text-align:center; font-size:0.9em;">対象を選択</div>
                <button class="btn btn-magic" id="btn-target-0" onclick="resolveTarget(0)">勇者</button>
                <button class="btn btn-magic" id="btn-target-1" onclick="resolveTarget(1)">魔法使い</button>
                <button class="btn btn-magic" id="btn-target-2" onclick="resolveTarget(2)">僧侶</button>
                <button class="btn" onclick="closeSpellMenu()" style="grid-column: 1 / -1;">↩️ 戻る</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>