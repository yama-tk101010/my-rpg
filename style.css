/* --- スマホ対応 (完全版) --- */
@media (max-width: 500px) {
    body {
        padding: 0;
        overflow: hidden;
    }

    h1 {
        font-size: 0.9rem;
        margin: 4px 0 2px 0;
    }

    #game-container {
        display: grid;
        /* 左:マップ(85px) 右:ステータス(残り) */
        grid-template-columns: 85px 1fr; 
        /* 行: 3D / マップ&ステータス / ログ / ボタン */
        grid-template-rows: auto auto 1fr auto;
        gap: 4px;
        height: 100vh;
        width: 100%;
        padding: 5px 0;
        border: none;
        border-radius: 0;
    }

    /* 1段目: 3Dビュー (全幅) */
    #main-area {
        grid-column: 1 / -1; /* ★ここも全幅 */
        height: 20vh;
        min-height: 120px;
        border-left: none; border-right: none;
        border-radius: 0;
    }
    #dungeon-canvas { height: 100%; width: auto; max-width: 100%; }
    #enemy-img { width: 100px; height: 100px; }

    /* 2段目左: マップ */
    #map-wrapper {
        grid-column: 1 / 2;
        justify-self: center;
        width: 85px;
    }
    #map-area { width: 80px; height: 80px; }
    #floor-display { font-size: 0.65em; }

    /* 2段目右: ステータス */
    #status {
        grid-column: 2 / 3;
        font-size: 0.75em;
        padding: 4px;
        flex-direction: column;
        justify-content: center;
        align-items: stretch;
        height: auto;
        border-right: none;
        border-radius: 0;
    }
    .party-status { gap: 2px; width: 100%; }
    .party-status div { display: flex; justify-content: space-between; white-space: nowrap; }
    .job-badge-sm { width: 1.2em; margin-right: 2px; font-size: 0.9em; }

    /* 3段目: ログ (全幅) */
    #log {
        grid-column: 1 / -1; /* ★ここが重要！全幅指定 */
        width: 100%;
        height: auto;
        min-height: 65px;
        font-size: 0.8em;
        margin: 0;
        background: #111;
        padding: 5px 8px;
        border-left: none; border-right: none;
        border-radius: 0;
        box-sizing: border-box;
    }

    /* バトルメッセージ (全幅) */
    #battle-msg {
        grid-column: 1 / -1; /* ★ここも全幅 */
        padding: 2px; font-size: 0.8em; margin-bottom: 1px;
        border-radius: 0; border-left: none; border-right: none;
    }

    /* 4段目: コントロール (全幅) */
    .controls {
        grid-column: 1 / -1; /* ★ここも全幅 */
        padding: 0 5px 5px 5px;
        align-self: end;
    }

    .move-pad { max-width: 100%; gap: 2px; margin: 0; }
    .move-pad .btn { height: 45px; font-size: 0.9em; }
    
    .battle-pad, .spell-pad, #target-controls { gap: 3px; }
    .battle-pad .btn, .spell-pad .btn { padding: 5px; font-size: 0.9em; height: 45px; }
    
    #btn-return { margin-top: 2px; height: 35px; font-size: 0.8em; }
}